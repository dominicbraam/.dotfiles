#!/bin/bash

function get_volume() {
    awk -F"[][]" '/Left:/ { gsub(/%/,"",$2); print $2 }' <(amixer sget Master)
}

function send_notification() {
    dunstify -a "changevolume" -u low -t 500 -r 9993 -i "$HOME/.dotfiles/icons/volume-$1.png" -h int:value:"$volume" "Volume: ${volume}%"
}

function toggle_mute() {
    if amixer sget Master | grep -q '\[on\]'; then
        amixer set Master mute
        dunstify -a "changevolume" -u low -t 500 -r 9993 -i "$HOME/.dotfiles/icons/volume-mute.png" "Muted"
    else
        amixer set Master unmute
        send_notification up
    fi
}

case $1 in

up)
    # Set the volume on (if it was muted)
    amixer set Master unmute
    amixer set Master 5%+
    volume=$(get_volume)
    send_notification "$1" "$volume"
    ;;

down)
    volume=$(get_volume)
    if [[ $volume -le 5 ]]; then
        [[ $volume -ne 0 ]] && amixer set Master 5%- && toggle_mute
    else
        amixer set Master unmute
        amixer set Master 5%-
        volume=$(get_volume)
        send_notification "$1" "$volume"
    fi
    ;;

mute)
    toggle_mute
    ;;

esac
